<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–ª—å–Ω–∞–±–æ–π—â–∏–∫–∏ –±–µ–∑ –∑–∞–ø–∞—Å–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #2c3e50, #34495e);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #f39c12;
            text-shadow: 0 0 10px rgba(243, 156, 18, 0.7);
        }
        
        .subtitle {
            color: #bdc3c7;
            font-size: 1.1rem;
        }
        
        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #f39c12;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #f39c12;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #bdc3c7;
        }
        
        .game-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            border: 3px solid #f39c12;
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .cargo-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .cargo-card {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #3498db;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .cargo-card:hover {
            transform: translateY(-5px);
            border-color: #f39c12;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }
        
        .cargo-card.selected {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }
        
        .cargo-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #7f8c8d;
        }
        
        .cargo-card.disabled:hover {
            transform: none;
            box-shadow: none;
            border-color: #7f8c8d;
        }
        
        .cargo-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .cargo-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #f39c12;
        }
        
        .cargo-price {
            font-size: 1rem;
            color: #bdc3c7;
        }
        
        .cargo-profit {
            font-size: 1rem;
            color: #2ecc71;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            background: linear-gradient(to bottom, #f39c12, #e67e22);
            border: none;
            border-radius: 50px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.6);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10;
            text-align: center;
            padding: 20px;
        }
        
        .screen h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #f39c12;
        }
        
        .screen p {
            font-size: 1.2rem;
            margin-bottom: 15px;
            max-width: 80%;
            line-height: 1.5;
        }
        
        .hidden {
            display: none;
        }
        
        .progress-bar {
            width: 80%;
            height: 20px;
            background: #34495e;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #2ecc71, #f39c12);
            border-radius: 10px;
            transition: width 0.3s;
            width: 0%;
        }
        
        .trip-info {
            display: flex;
            justify-content: space-between;
            width: 80%;
            margin-top: 10px;
            font-size: 1rem;
            color: #bdc3c7;
        }
        
        .event-log {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #f39c12;
            max-width: 300px;
            font-size: 0.9rem;
        }
        
        .event-item {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #f39c12;
            background: rgba(243, 156, 18, 0.1);
        }
        
        .game-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 20px;
        }
        
        /* –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä */
        .music-player {
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 1px solid #f39c12;
        }
        
        .player-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .music-input {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #f39c12;
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .music-input::placeholder {
            color: #bdc3c7;
        }
        
        .player-btn {
            padding: 8px 15px;
            background: #f39c12;
            border: none;
            border-radius: 5px;
            color: #000;
            cursor: pointer;
            font-weight: bold;
        }
        
        .weather-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #f39c12;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @media (max-width: 768px) {
            .game-stats, .cargo-selection {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .music-player {
                padding: 10px;
            }
            
            .player-controls {
                flex-direction: column;
            }
            
            .weather-indicator {
                top: 5px;
                right: 5px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–î–ê–õ–¨–ù–û–ë–û–ô–©–ò–ö: –°–¢–ê–†–¢ –° –ù–£–õ–Ø</h1>
            <div class="subtitle">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –¥–µ–Ω—å–≥–∏, –¥–æ—Å—Ç–∞–≤–ª—è—è –≥—Ä—É–∑—ã –ø–æ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–µ!</div>
        </header>
        
        <div class="game-stats">
            <div class="stat-card">
                <div class="stat-value" id="money">$100</div>
                <div class="stat-label">–ö–ê–ü–ò–¢–ê–õ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="distance">0 –∫–º</div>
                <div class="stat-label">–ü–†–û–ô–î–ï–ù–û</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="deliveries">0</div>
                <div class="stat-label">–î–û–°–¢–ê–í–û–ö</div>
            </div>
        </div>
        
        <div class="game-container">
            <div id="weatherIndicator" class="weather-indicator hidden">
                <span id="weatherIcon">‚òÄÔ∏è</span>
                <span id="weatherText">–ü–æ–≥–æ–¥–∞: –°–æ–ª–Ω–µ—á–Ω–æ</span>
            </div>
            
            <div id="startScreen" class="screen">
                <h2>–î–û–ë–†–û –ü–û–ñ–ê–õ–û–í–ê–¢–¨!</h2>
                <p>–í—ã - –Ω–∞—á–∏–Ω–∞—é—â–∏–π –¥–∞–ª—å–Ω–æ–±–æ–π—â–∏–∫. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ - –¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –≥—Ä—É–∑—ã –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏.</p>
                <p>–ü–µ—Ä–≤—ã–π –≥—Ä—É–∑ - –±–µ—Å–ø–ª–∞—Ç–Ω–æ! –í—ã–±–∏—Ä–∞–π—Ç–µ —Ç–æ–≤–∞—Ä –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ—Å—å –≤ –ø—É—Ç—å.</p>
                <button id="startButton">–ù–ê–ß–ê–¢–¨ –ö–ê–†–¨–ï–†–£</button>
            </div>
            
            <div id="cargoScreen" class="screen hidden">
                <h2>–í–´–ë–ï–†–ò–¢–ï –ì–†–£–ó</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏. –ü–µ—Ä–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ - –±–µ—Å–ø–ª–∞—Ç–Ω–æ!</p>
                <div class="cargo-selection">
                    <div class="cargo-card" data-type="grain">
                        <div class="cargo-icon">üåæ</div>
                        <div class="cargo-name">–ó–ï–†–ù–û</div>
                        <div class="cargo-price">–¶–µ–Ω–∞: <span id="grainPrice">$50</span></div>
                        <div class="cargo-profit">–ü—Ä–∏–±—ã–ª—å: <span id="grainProfit">$100</span></div>
                    </div>
                    <div class="cargo-card" data-type="fertilizer">
                        <div class="cargo-icon">üß™</div>
                        <div class="cargo-name">–£–î–û–ë–†–ï–ù–ò–Ø</div>
                        <div class="cargo-price">–¶–µ–Ω–∞: <span id="fertilizerPrice">$80</span></div>
                        <div class="cargo-profit">–ü—Ä–∏–±—ã–ª—å: <span id="fertilizerProfit">$150</span></div>
                    </div>
                    <div class="cargo-card" data-type="lego">
                        <div class="cargo-icon">üß±</div>
                        <div class="cargo-name">–ö–û–ù–°–¢–†–£–ö–¢–û–†</div>
                        <div class="cargo-price">–¶–µ–Ω–∞: <span id="legoPrice">$120</span></div>
                        <div class="cargo-profit">–ü—Ä–∏–±—ã–ª—å: <span id="legoProfit">$200</span></div>
                    </div>
                </div>
                <button id="deliverButton" disabled>–ù–ê–ß–ê–¢–¨ –î–û–°–¢–ê–í–ö–£</button>
            </div>
            
            <div id="gameScreen" class="screen hidden">
                <div class="game-content">
                    <h2>–í –ü–£–¢–ò...</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="trip-info">
                        <span>–û—Å—Ç–∞–ª–æ—Å—å: <span id="remainingDistance">1000</span> –∫–º</span>
                        <span>–¢–µ–∫—É—â–∏–π –≥—Ä—É–∑: <span id="currentCargo">-</span></span>
                    </div>
                    <canvas id="gameCanvas"></canvas>
                </div>
            </div>
            
            <div id="resultScreen" class="screen hidden">
                <h2>–î–û–°–¢–ê–í–ö–ê –í–´–ü–û–õ–ù–ï–ù–ê!</h2>
                <p>–í—ã —É—Å–ø–µ—à–Ω–æ –¥–æ—Å—Ç–∞–≤–∏–ª–∏ –≥—Ä—É–∑ <span id="deliveredCargo">-</span></p>
                <p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="earnedMoney" style="color: #2ecc71">$0</span></p>
                <p>–û–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª: <span id="totalMoney" style="color: #f39c12">$0</span></p>
                <button id="nextDeliveryButton">–°–õ–ï–î–£–Æ–©–ê–Ø –î–û–°–¢–ê–í–ö–ê</button>
            </div>
            
            <div id="eventLog" class="event-log hidden">
                <h3>–°–û–ë–´–¢–ò–Ø:</h3>
                <div id="eventList"></div>
            </div>
        </div>
        
        <div class="controls">
            <button id="buyCargoButton" disabled>–ö–£–ü–ò–¢–¨ –ì–†–£–ó</button>
            <button id="upgradeTruckButton" disabled>–£–õ–£–ß–®–ò–¢–¨ –ì–†–£–ó–û–í–ò–ö ($500)</button>
        </div>
        
        <!-- –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä -->
        <div class="music-player">
            <div class="player-controls">
                <input type="text" id="musicUrl" class="music-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –º—É–∑—ã–∫—É (MP3)">
                <button id="playMusicBtn" class="player-btn">‚ñ∂Ô∏è –í–∫–ª—é—á–∏—Ç—å</button>
                <button id="pauseMusicBtn" class="player-btn">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                <button id="stopMusicBtn" class="player-btn">‚èπÔ∏è –°—Ç–æ–ø</button>
            </div>
            <div id="musicStatus" style="color: #f39c12; text-align: center; font-size: 0.9rem;">
                –ú—É–∑—ã–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ MP3 —Ñ–∞–π–ª.
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');
        const cargoScreen = document.getElementById('cargoScreen');
        const gameScreen = document.getElementById('gameScreen');
        const resultScreen = document.getElementById('resultScreen');
        const startButton = document.getElementById('startButton');
        const deliverButton = document.getElementById('deliverButton');
        const nextDeliveryButton = document.getElementById('nextDeliveryButton');
        const buyCargoButton = document.getElementById('buyCargoButton');
        const upgradeTruckButton = document.getElementById('upgradeTruckButton');
        const weatherIndicator = document.getElementById('weatherIndicator');
        const weatherIcon = document.getElementById('weatherIcon');
        const weatherText = document.getElementById('weatherText');
        
        // –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä
        const musicUrlInput = document.getElementById('musicUrl');
        const playMusicBtn = document.getElementById('playMusicBtn');
        const pauseMusicBtn = document.getElementById('pauseMusicBtn');
        const stopMusicBtn = document.getElementById('stopMusicBtn');
        const musicStatus = document.getElementById('musicStatus');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const moneyElement = document.getElementById('money');
        const distanceElement = document.getElementById('distance');
        const deliveriesElement = document.getElementById('deliveries');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        const progressFill = document.getElementById('progressFill');
        const remainingDistanceElement = document.getElementById('remainingDistance');
        const currentCargoElement = document.getElementById('currentCargo');
        const deliveredCargoElement = document.getElementById('deliveredCargo');
        const earnedMoneyElement = document.getElementById('earnedMoney');
        const totalMoneyElement = document.getElementById('totalMoney');
        
        // –¶–µ–Ω—ã –∏ –ø—Ä–∏–±—ã–ª—å
        const grainPriceElement = document.getElementById('grainPrice');
        const grainProfitElement = document.getElementById('grainProfit');
        const fertilizerPriceElement = document.getElementById('fertilizerPrice');
        const fertilizerProfitElement = document.getElementById('fertilizerProfit');
        const legoPriceElement = document.getElementById('legoPrice');
        const legoProfitElement = document.getElementById('legoProfit');
        
        // –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π
        const eventLog = document.getElementById('eventLog');
        const eventList = document.getElementById('eventList');

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let gameState = {
            money: 100,
            totalDistance: 0,
            deliveries: 0,
            currentCargo: null,
            currentTripDistance: 0,
            totalTripDistance: 1000,
            truckSpeed: 50, // –∫–º/—á –≤ –∏–≥—Ä–æ–≤–æ–º –≤—Ä–µ–º–µ–Ω–∏
            truckLevel: 1,
            isFirstDelivery: true,
            weatherType: 0, // 0 - —Å–æ–ª–Ω–µ—á–Ω–æ, 1 - –¥–æ–∂–¥—å, 2 - —Å–Ω–µ–≥, 3 - –Ω–æ—á—å
            biomeType: 0, // 0 - –ª–µ—Å, 1 - –ø—É—Å—Ç—ã–Ω—è, 2 - –≥–æ—Ä—ã, 3 - —Ä–∞–≤–Ω–∏–Ω–∞
            lastBiomeChangeAt: 0 // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã
        };

        // –ú—É–∑—ã–∫–∞
        let audioPlayer = null;
        let currentMusicUrl = '';

        // –≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏–≥—Ä—ã
        const cargoTypes = {
            grain: {
                name: "–ó–µ—Ä–Ω–æ",
                icon: "üåæ",
                basePrice: 50,
                baseProfit: 100,
                priceMultiplier: 1.3,
                profitMultiplier: 1.25
            },
            fertilizer: {
                name: "–£–¥–æ–±—Ä–µ–Ω–∏—è",
                icon: "üß™",
                basePrice: 80,
                baseProfit: 150,
                priceMultiplier: 1.4,
                profitMultiplier: 1.35
            },
            lego: {
                name: "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä",
                icon: "üß±",
                basePrice: 120,
                baseProfit: 200,
                priceMultiplier: 1.5,
                profitMultiplier: 1.45
            }
        };

        // –¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã
        let currentPrices = {};
        let currentProfits = {};

        // –ê–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let truckX = 100;
        let backgroundOffset = 0;
        let lastUpdateTime = 0;
        let animationId = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω
        function initializePrices() {
            for (const type in cargoTypes) {
                const cargo = cargoTypes[type];
                currentPrices[type] = cargo.basePrice;
                currentProfits[type] = cargo.baseProfit;
            }
            updateCargoDisplay();
            updateCargoAvailability();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≥—Ä—É–∑–æ–≤
        function updateCargoAvailability() {
            const cargoCards = document.querySelectorAll('.cargo-card');
            cargoCards.forEach(card => {
                const cargoType = card.dataset.type;
                const price = gameState.isFirstDelivery ? 0 : currentPrices[cargoType];
                
                if (gameState.money >= price || gameState.isFirstDelivery) {
                    card.classList.remove('disabled');
                } else {
                    card.classList.add('disabled');
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω
        function updateCargoDisplay() {
            grainPriceElement.textContent = `$${currentPrices.grain}`;
            grainProfitElement.textContent = `$${currentProfits.grain}`;
            fertilizerPriceElement.textContent = `$${currentPrices.fertilizer}`;
            fertilizerProfitElement.textContent = `$${currentProfits.fertilizer}`;
            legoPriceElement.textContent = `$${currentPrices.lego}`;
            legoProfitElement.textContent = `$${currentProfits.lego}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            moneyElement.textContent = `$${gameState.money}`;
            distanceElement.textContent = `${Math.round(gameState.totalDistance)} –∫–º`;
            deliveriesElement.textContent = gameState.deliveries;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            buyCargoButton.disabled = gameState.currentCargo !== null;
            upgradeTruckButton.disabled = gameState.money < 500;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≥—Ä—É–∑–æ–≤
            updateCargoAvailability();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ–Ω—É –ø–æ–≥–æ–¥—ã –∏ –±–∏–æ–º–∞ –∫–∞–∂–¥—ã–µ 1000 –∫–º
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º Math.floor —á—Ç–æ–±—ã —Å–º–µ–Ω–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ —Ç–æ—á–Ω–æ –Ω–∞ 1000, 2000, 3000 –∫–º –∏ —Ç.–¥.
            const currentThousand = Math.floor(gameState.totalDistance / 1000);
            const lastThousand = Math.floor(gameState.lastBiomeChangeAt / 1000);
            
            if (currentThousand > lastThousand) {
                changeWeatherAndBiome();
                gameState.lastBiomeChangeAt = gameState.totalDistance;
            }
        }

        // –°–º–µ–Ω–∞ –ø–æ–≥–æ–¥—ã –∏ –±–∏–æ–º–∞
        function changeWeatherAndBiome() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const oldWeather = gameState.weatherType;
            const oldBiome = gameState.biomeType;
            
            // –°–ª—É—á–∞–π–Ω–æ –º–µ–Ω—è–µ–º –ø–æ–≥–æ–¥—É (–Ω–æ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é)
            let newWeather;
            do {
                newWeather = Math.floor(Math.random() * 4);
            } while (newWeather === oldWeather);
            gameState.weatherType = newWeather;
            
            // –°–ª—É—á–∞–π–Ω–æ –º–µ–Ω—è–µ–º –±–∏–æ–º (–Ω–æ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π)
            let newBiome;
            do {
                newBiome = Math.floor(Math.random() * 4);
            } while (newBiome === oldBiome);
            gameState.biomeType = newBiome;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–≥–æ–¥—ã
            updateWeatherIndicator();
            
            if (oldWeather !== gameState.weatherType) {
                addEvent(`–ü–æ–≥–æ–¥–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å: ${getWeatherText(gameState.weatherType)}`);
            }
            
            if (oldBiome !== gameState.biomeType) {
                addEvent(`–í—ã –≤—ä–µ—Ö–∞–ª–∏ –≤ ${getBiomeText(gameState.biomeType)}`);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ–≥–æ–¥—ã
        function getWeatherText(weatherType) {
            switch(weatherType) {
                case 0: return "–°–æ–ª–Ω–µ—á–Ω–æ ‚òÄÔ∏è";
                case 1: return "–î–æ–∂–¥—å üåßÔ∏è";
                case 2: return "–°–Ω–µ–≥ ‚ùÑÔ∏è";
                case 3: return "–ù–æ—á—å üåô";
                default: return "–°–æ–ª–Ω–µ—á–Ω–æ ‚òÄÔ∏è";
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –±–∏–æ–º–∞
        function getBiomeText(biomeType) {
            switch(biomeType) {
                case 0: return "–ª–µ—Å–Ω–æ–π –º–∞—Å—Å–∏–≤ üå≤";
                case 1: return "–ø—É—Å—Ç—ã–Ω—é üèúÔ∏è";
                case 2: return "–≥–æ—Ä–Ω—É—é –º–µ—Å—Ç–Ω–æ—Å—Ç—å ‚õ∞Ô∏è";
                case 3: return "—Ä–∞–≤–Ω–∏–Ω—É üåæ";
                default: return "–ª–µ—Å–Ω–æ–π –º–∞—Å—Å–∏–≤ üå≤";
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–≥–æ–¥—ã
        function updateWeatherIndicator() {
            const weatherData = getWeatherData(gameState.weatherType);
            weatherIcon.textContent = weatherData.icon;
            weatherText.textContent = `–ü–æ–≥–æ–¥–∞: ${weatherData.text} | –ú–µ—Å—Ç–Ω–æ—Å—Ç—å: ${getBiomeText(gameState.biomeType)}`;
            weatherIndicator.classList.remove('hidden');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
        function getWeatherData(weatherType) {
            switch(weatherType) {
                case 0: return {icon: "‚òÄÔ∏è", text: "–°–æ–ª–Ω–µ—á–Ω–æ", skyColor: "#87CEEB", roadColor: "#34495e"};
                case 1: return {icon: "üåßÔ∏è", text: "–î–æ–∂–¥—å", skyColor: "#5D6D7E", roadColor: "#2C3E50"};
                case 2: return {icon: "‚ùÑÔ∏è", text: "–°–Ω–µ–≥", skyColor: "#D5D8DC", roadColor: "#7B7D7D"};
                case 3: return {icon: "üåô", text: "–ù–æ—á—å", skyColor: "#1C2833", roadColor: "#17202A"};
                default: return {icon: "‚òÄÔ∏è", text: "–°–æ–ª–Ω–µ—á–Ω–æ", skyColor: "#87CEEB", roadColor: "#34495e"};
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥
        function addEvent(message) {
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.textContent = message;
            eventList.appendChild(eventItem);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥
            eventLog.classList.remove('hidden');
            
            // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
            eventList.scrollTop = eventList.scrollHeight;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π
            if (eventList.children.length > 10) {
                eventList.removeChild(eventList.firstChild);
            }
        }

        // –í—ã–±–æ—Ä –≥—Ä—É–∑–∞
        let selectedCargo = null;
        const cargoCards = document.querySelectorAll('.cargo-card');
        
        cargoCards.forEach(card => {
            card.addEventListener('click', () => {
                if (card.classList.contains('disabled')) return;
                
                // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                cargoCards.forEach(c => c.classList.remove('selected'));
                // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é
                card.classList.add('selected');
                selectedCargo = card.dataset.type;
                deliverButton.disabled = false;
            });
        });

        // –ù–∞—á–∞–ª–æ –¥–æ—Å—Ç–∞–≤–∫–∏
        deliverButton.addEventListener('click', () => {
            if (!selectedCargo) return;
            
            const cargo = cargoTypes[selectedCargo];
            const price = gameState.isFirstDelivery ? 0 : currentPrices[selectedCargo];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ö–≤–∞—Ç–∞–µ—Ç –ª–∏ –¥–µ–Ω–µ–≥ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏)
            if (gameState.isFirstDelivery || gameState.money >= price) {
                // –°–ø–∏—Å–∞–Ω–∏–µ –¥–µ–Ω–µ–≥ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏)
                if (!gameState.isFirstDelivery) {
                    gameState.money -= price;
                    addEvent(`–ö—É–ø–ª–µ–Ω –≥—Ä—É–∑: ${cargo.name} –∑–∞ $${price}`);
                } else {
                    addEvent(`–ü–µ—Ä–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: ${cargo.name} (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)`);
                    gameState.isFirstDelivery = false;
                }
                
                gameState.currentCargo = selectedCargo;
                gameState.currentTripDistance = 0;
                gameState.totalTripDistance = 1000 + (gameState.deliveries * 200); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏—é
                
                cargoScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                startDelivery();
                
                addEvent(`–ù–∞—á–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∞ ${cargo.name} –Ω–∞ ${gameState.totalTripDistance} –∫–º`);
            } else {
                addEvent(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ ${cargo.name}!`);
            }
        });

        // –°–ª–µ–¥—É—é—â–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
        nextDeliveryButton.addEventListener('click', () => {
            resultScreen.classList.add('hidden');
            cargoScreen.classList.remove('hidden');
            
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ü–µ–Ω—ã –∏ –ø—Ä–∏–±—ã–ª—å
            for (const type in cargoTypes) {
                const cargo = cargoTypes[type];
                currentPrices[type] = Math.round(currentPrices[type] * cargo.priceMultiplier);
                currentProfits[type] = Math.round(currentProfits[type] * cargo.profitMultiplier);
            }
            
            updateCargoDisplay();
            updateStats();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –≥—Ä—É–∑–∞
            selectedCargo = null;
            deliverButton.disabled = true;
            cargoCards.forEach(c => c.classList.remove('selected'));
        });

        // –ü–æ–∫—É–ø–∫–∞ –≥—Ä—É–∑–∞
        buyCargoButton.addEventListener('click', () => {
            cargoScreen.classList.remove('hidden');
        });

        // –£–ª—É—á—à–µ–Ω–∏–µ –≥—Ä—É–∑–æ–≤–∏–∫–∞
        upgradeTruckButton.addEventListener('click', () => {
            if (gameState.money >= 500) {
                gameState.money -= 500;
                gameState.truckLevel++;
                gameState.truckSpeed = 50 + (gameState.truckLevel * 20);
                addEvent(`–ì—Ä—É–∑–æ–≤–∏–∫ —É–ª—É—á—à–µ–Ω –¥–æ —É—Ä–æ–≤–Ω—è ${gameState.truckLevel}! –°–∫–æ—Ä–æ—Å—Ç—å —É–≤–µ–ª–∏—á–µ–Ω–∞.`);
                updateStats();
            }
        });

        // –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä
        function initializeMusicPlayer() {
            playMusicBtn.addEventListener('click', () => {
                const url = musicUrlInput.value.trim();
                if (url && url !== currentMusicUrl) {
                    if (audioPlayer) {
                        audioPlayer.pause();
                        audioPlayer = null;
                    }
                    
                    try {
                        audioPlayer = new Audio(url);
                        audioPlayer.loop = true;
                        currentMusicUrl = url;
                        
                        audioPlayer.play().then(() => {
                            musicStatus.textContent = "–ú—É–∑—ã–∫–∞ –∏–≥—Ä–∞–µ—Ç...";
                            musicStatus.style.color = "#2ecc71";
                        }).catch(error => {
                            musicStatus.textContent = "–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É.";
                            musicStatus.style.color = "#e74c3c";
                            console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:", error);
                        });
                    } catch (error) {
                        musicStatus.textContent = "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –º—É–∑—ã–∫—É";
                        musicStatus.style.color = "#e74c3c";
                    }
                } else if (audioPlayer && currentMusicUrl) {
                    audioPlayer.play();
                    musicStatus.textContent = "–ú—É–∑—ã–∫–∞ –∏–≥—Ä–∞–µ—Ç...";
                    musicStatus.style.color = "#2ecc71";
                }
            });
            
            pauseMusicBtn.addEventListener('click', () => {
                if (audioPlayer && !audioPlayer.paused) {
                    audioPlayer.pause();
                    musicStatus.textContent = "–ú—É–∑—ã–∫–∞ –Ω–∞ –ø–∞—É–∑–µ";
                    musicStatus.style.color = "#f39c12";
                }
            });
            
            stopMusicBtn.addEventListener('click', () => {
                if (audioPlayer) {
                    audioPlayer.pause();
                    audioPlayer.currentTime = 0;
                    musicStatus.textContent = "–ú—É–∑—ã–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞";
                    musicStatus.style.color = "#e74c3c";
                }
            });
            
            // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –º—É–∑—ã–∫–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
            musicUrlInput.placeholder = "–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –º—É–∑—ã–∫—É (MP3) –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º";
        }

        // –ù–∞—á–∞–ª–æ –¥–æ—Å—Ç–∞–≤–∫–∏
        function startDelivery() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä canvas
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            truckX = 100;
            backgroundOffset = 0;
            lastUpdateTime = performance.now();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–≥–æ–¥—ã
            updateWeatherIndicator();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            animationId = requestAnimationFrame(gameLoop);
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastUpdateTime) / 1000; // –í —Å–µ–∫—É–Ω–¥–∞—Ö
            lastUpdateTime = currentTime;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã
            updateGame(deltaTime);
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            drawGame();
            
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é, –µ—Å–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
            if (gameState.currentTripDistance < gameState.totalTripDistance) {
                animationId = requestAnimationFrame(gameLoop);
            } else {
                finishDelivery();
            }
        }

        function updateGame(deltaTime) {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–≤ –∫–º)
            const distanceThisFrame = (gameState.truckSpeed * deltaTime) / 3.6; // –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ –∫–º
            gameState.currentTripDistance += distanceThisFrame;
            gameState.totalDistance += distanceThisFrame;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            backgroundOffset += gameState.truckSpeed * deltaTime * 2;
            if (backgroundOffset > canvas.width) {
                backgroundOffset = 0;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            const progress = (gameState.currentTripDistance / gameState.totalTripDistance) * 100;
            progressFill.style.width = `${progress}%`;
            remainingDistanceElement.textContent = Math.max(0, Math.round(gameState.totalTripDistance - gameState.currentTripDistance));
            currentCargoElement.textContent = cargoTypes[gameState.currentCargo].name;
            
            updateStats();
        }

        function drawGame() {
            const weatherData = getWeatherData(gameState.weatherType);
            
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –Ω–µ–±–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–≥–æ–¥—ã
            const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            skyGradient.addColorStop(0, weatherData.skyColor);
            skyGradient.addColorStop(1, lightenColor(weatherData.skyColor, 30));
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height - 100);
            
            // –†–∏—Å—É–µ–º –¥–æ—Ä–æ–≥—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–≥–æ–¥—ã
            ctx.fillStyle = weatherData.roadColor;
            ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
            
            // –†–∏—Å—É–µ–º —Ä–∞–∑–º–µ—Ç–∫—É (–¥–≤–∏–∂—É—â—É—é—Å—è)
            ctx.fillStyle = (gameState.weatherType === 3) ? '#f39c12' : '#ffffff'; // –ù–æ—á—å—é –∂–µ–ª—Ç–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞
            for (let i = -backgroundOffset % 40; i < canvas.width; i += 40) {
                ctx.fillRect(i, canvas.height - 50, 20, 5);
            }
            
            // –†–∏—Å—É–µ–º –ø–µ–π–∑–∞–∂ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∏–æ–º–∞
            drawBiome();
            
            // –†–∏—Å—É–µ–º –ø–æ–≥–æ–¥–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
            drawWeatherEffects();
            
            // –†–∏—Å—É–µ–º –≥—Ä—É–∑–æ–≤–∏–∫
            drawTruck();
        }

        function drawBiome() {
            const biomeColors = {
                0: { // –õ–µ—Å
                    ground: '#27ae60',
                    objects: '#2ecc71',
                    detail: '#229954'
                },
                1: { // –ü—É—Å—Ç—ã–Ω—è
                    ground: '#f39c12',
                    objects: '#e67e22',
                    detail: '#d35400'
                },
                2: { // –ì–æ—Ä—ã
                    ground: '#7f8c8d',
                    objects: '#95a5a6',
                    detail: '#5d6d7e'
                },
                3: { // –†–∞–≤–Ω–∏–Ω–∞
                    ground: '#2ecc71',
                    objects: '#27ae60',
                    detail: '#229954'
                }
            };
            
            const colors = biomeColors[gameState.biomeType] || biomeColors[0];
            
            // –†–∏—Å—É–µ–º –∑–µ–º–ª—é
            ctx.fillStyle = colors.ground;
            ctx.fillRect(0, canvas.height - 100, canvas.width, 30);
            
            // –†–∏—Å—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –±–∏–æ–º–∞
            switch(gameState.biomeType) {
                case 0: // –õ–µ—Å - –¥–µ—Ä–µ–≤—å—è
                    for (let i = -backgroundOffset % 150; i < canvas.width; i += 150) {
                        drawTree(i, canvas.height - 120);
                    }
                    break;
                case 1: // –ü—É—Å—Ç—ã–Ω—è - –∫–∞–∫—Ç—É—Å—ã
                    for (let i = -backgroundOffset % 120; i < canvas.width; i += 120) {
                        drawCactus(i, canvas.height - 110);
                    }
                    break;
                case 2: // –ì–æ—Ä—ã - —Å–∫–∞–ª—ã
                    for (let i = -backgroundOffset % 200; i < canvas.width; i += 200) {
                        drawMountain(i, canvas.height - 120);
                    }
                    break;
                case 3: // –†–∞–≤–Ω–∏–Ω–∞ - –∫—É—Å—Ç—ã
                    for (let i = -backgroundOffset % 100; i < canvas.width; i += 100) {
                        drawBush(i, canvas.height - 110);
                    }
                    break;
            }
        }

        function drawTree(x, y) {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x, y, 10, 40);
            ctx.fillStyle = '#27ae60';
            ctx.beginPath();
            ctx.arc(x + 5, y - 15, 25, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawCactus(x, y) {
            ctx.fillStyle = '#27ae60';
            ctx.fillRect(x, y, 15, 50);
            ctx.fillRect(x - 10, y + 10, 10, 15);
            ctx.fillRect(x + 15, y + 20, 10, 15);
        }

        function drawMountain(x, y) {
            ctx.fillStyle = '#7f8c8d';
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + 60, y - 40);
            ctx.lineTo(x + 120, y);
            ctx.fill();
        }

        function drawBush(x, y) {
            ctx.fillStyle = '#229954';
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.arc(x + 15, y - 5, 12, 0, Math.PI * 2);
            ctx.arc(x - 10, y - 5, 12, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawWeatherEffects() {
            if (gameState.weatherType === 1) { // –î–æ–∂–¥—å
                ctx.strokeStyle = 'rgba(173, 216, 230, 0.7)';
                ctx.lineWidth = 1;
                for (let i = 0; i < 50; i++) {
                    const x = (i * 20 + backgroundOffset * 2) % canvas.width;
                    const y = (i * 15 + backgroundOffset) % canvas.height;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x - 5, y + 20);
                    ctx.stroke();
                }
            } else if (gameState.weatherType === 2) { // –°–Ω–µ–≥
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                for (let i = 0; i < 30; i++) {
                    const x = (i * 30 + backgroundOffset * 1.5) % canvas.width;
                    const y = (i * 20 + backgroundOffset) % canvas.height;
                    ctx.beginPath();
                    ctx.arc(x, y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            } else if (gameState.weatherType === 3) { // –ù–æ—á—å - –∑–≤—ë–∑–¥—ã
                ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                for (let i = 0; i < 20; i++) {
                    const x = (i * 40) % canvas.width;
                    const y = (i * 20) % (canvas.height - 100);
                    ctx.beginPath();
                    ctx.arc(x, y, 1, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        function drawTruck() {
            const truckY = canvas.height - 150;
            
            // –ö—É–∑–æ–≤ –≥—Ä—É–∑–æ–≤–∏–∫–∞ - –û–†–ê–ù–ñ–ï–í–´–ô
            ctx.fillStyle = '#FF8C00'; // –¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π
            ctx.fillRect(truckX, truckY, 120, 50);
            
            // –ö–∞–±–∏–Ω–∞ - –Ω–µ–º–Ω–æ–≥–æ —Ç–µ–º–Ω–µ–µ –æ—Ä–∞–Ω–∂–µ–≤—ã–π
            ctx.fillStyle = '#FF7F00';
            ctx.fillRect(truckX + 80, truckY - 30, 40, 30);
            
            // –û–∫–Ω–∞
            ctx.fillStyle = '#aed6f1';
            ctx.fillRect(truckX + 85, truckY - 25, 30, 15);
            
            // –§–∞—Ä—ã
            ctx.fillStyle = '#f1c40f';
            ctx.fillRect(truckX, truckY + 10, 10, 5);
            
            // –ó–∞–¥–Ω–∏–µ —Ñ–æ–Ω–∞—Ä–∏
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(truckX + 120, truckY + 10, 5, 10);
            
            // –ö–æ–ª—ë—Å–∞
            ctx.fillStyle = '#2c3e50';
            ctx.beginPath();
            ctx.arc(truckX + 30, truckY + 50, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(truckX + 90, truckY + 50, 15, 0, Math.PI * 2);
            ctx.fill();
            
            // –î–∏—Å–∫–∏
            ctx.fillStyle = '#7f8c8d';
            ctx.beginPath();
            ctx.arc(truckX + 30, truckY + 50, 8, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(truckX + 90, truckY + 50, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì—Ä—É–∑ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞)
            const cargo = cargoTypes[gameState.currentCargo];
            ctx.fillStyle = getCargoColor(gameState.currentCargo);
            ctx.fillRect(truckX + 10, truckY - 20, 60, 15);
            
            // –ò–∫–æ–Ω–∫–∞ –≥—Ä—É–∑–∞
            ctx.font = '20px Arial';
            ctx.fillText(cargo.icon, truckX + 35, truckY - 5);
        }

        function getCargoColor(cargoType) {
            switch(cargoType) {
                case 'grain': return '#f1c40f';
                case 'fertilizer': return '#27ae60';
                case 'lego': return '#e74c3c';
                default: return '#3498db';
            }
        }

        function lightenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return `#${(
                0x1000000 + 
                (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
                (B < 255 ? B < 1 ? 0 : B : 255)
            ).toString(16).slice(1)}`;
        }

        function finishDelivery() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            const cargo = cargoTypes[gameState.currentCargo];
            const profit = currentProfits[gameState.currentCargo];
            
            // –ù–∞—á–∏—Å–ª—è–µ–º –ø—Ä–∏–±—ã–ª—å
            gameState.money += profit;
            gameState.deliveries++;
            gameState.currentCargo = null;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            deliveredCargoElement.textContent = cargo.name;
            earnedMoneyElement.textContent = `$${profit}`;
            totalMoneyElement.textContent = `$${gameState.money}`;
            
            addEvent(`–î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: $${profit}`);
            
            updateStats();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        startButton.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            cargoScreen.classList.remove('hidden');
            initializePrices();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–º–µ–Ω—ã
            gameState.lastBiomeChangeAt = 0;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –ø–æ–≥–æ–¥—É –∏ –±–∏–æ–º
            gameState.weatherType = 0; // —Å–æ–ª–Ω–µ—á–Ω–æ
            gameState.biomeType = 0; // –ª–µ—Å
            
            updateStats();
            initializeMusicPlayer();
            addEvent("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –¥–∞–ª—å–Ω–æ–±–æ–π—â–∏–∫–æ–≤!");
            addEvent(`–ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–≥–æ–¥–∞: ${getWeatherText(gameState.weatherType)}`);
            addEvent(`–ù–∞—á–∞–ª—å–Ω–∞—è –º–µ—Å—Ç–Ω–æ—Å—Ç—å: ${getBiomeText(gameState.biomeType)}`);
        });

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ canvas
        window.addEventListener('resize', () => {
            if (gameScreen.classList.contains('hidden')) return;
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        });
    </script>
</body>

</html>
